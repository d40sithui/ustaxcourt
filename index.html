<!DOCTYPE html>
<html>
<head>
<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
<script src="jquery.csv.js"></script>
<script>
$(document).ready(function(){

  var plans;
  var zips;
  var silverPlans = new Array(); //stores only silver plans
  var slcsp =  new Array(); //stores the second lowest rate per rate_area


  /* ***************************
  Convert PLANS.CSV to array
  **************************** */
	$.ajax({
	  type: "GET",  
	  url: "plans.csv",
	  dataType: "text",
    async: false,       
	  success: function(response)  
	  {
		data = $.csv.toArrays(response);
      plans = data;
	  }   

	});

  /* ***************************
  Convert ZIPS.CSV to array
  **************************** */
	$.ajax({
	  type: "GET",  
	  url: "zips.csv",
	  dataType: "text",
    async: false,       
	  success: function(response)  
	  {
		data = $.csv.toArrays(response);
      zips = data;
	  }   

	});

  /* ***************************
  Filter to only Silver plans
  ***************************** */
  var i;
  var j = 0;
  for (i = 0; i < plans.length; ++i) {
    if(plans[i][2]=="Silver"){
      silverPlans[j] = plans[i];
      j++;
    }
  }

  //plans.splice(0,1);

  
  /* ***************************
  find second lowest rate for each silver plan per state code and rate_area
  **************************** */
 for (i =0; i < silverPlans.length; ++i){
   var subSlcsp = new Array();
   var k = 0;
   var smallest;
   var secondSmallest;

   for(j =0; j < silverPlans.length; j++){

      if (i != j){ //dont run if we are matching the same item
        //finds common all states and rate_area and adds them to a temp array
        if(silverPlans[i][1] == silverPlans[j][1] && silverPlans[i][4] == silverPlans[j][4]){
          subSlcsp[k][0] = silverPlans[i][0]; //plan_id
          subSlcsp[k][1] = silverPlans[i][1]; //state
          subSlcsp[k][2] = silverPlans[i][3]; //rate
          k++;
        }
      }
   } //ends for(j)

   console.log(subSlcsp);
  
   /*
   //find the smallest rate
   if(subSlcsp.length < 1){
     secondSmallest = null;
   }

   else if(subSlcsp.length==1){
     secondSmallest = subSlcsp[0][2];
   }
   else if(subSlcsp.length>1){
    for(l=0;l < subSlcsp.length; ++l){

    }
  }

  */

 }


  //print data to test
  text = "<table><tr><td>PLANS</td><td>ZIPS</td><td>silverPlans</td></tr><tr><td valign=top>"
  text += "<ul>";
    for (let i = 0; i < plans.length; i++) {
      text += "<li>" + plans[i] + "</li>";
      }
    text += "</ul>";

  text += "</td><td valign=top><ul>";
    for (let i = 0; i < zips.length; i++) {
      text += "<li>" + zips[i] + "</li>";
      }

  text += "</ul></td><td valign=top><ul>";
    for (i = 0; i < silverPlans.length; ++i) {
      text += "<li>" +silverPlans[i]+"</li>";
    }
    text += "</ul></td></tr></table>";


    $( "#plans_data" ).append(text);
  

    //prints entire list for PLANS
    //console.log(plans[1]); 

    //prints specific key, value
    //console.log(plans[1][0]); //plan_id
    //console.log(plans[1][1]); //state
    //console.log(plans[1][2]); //metal_level
    //console.log(plans[1][3]); //rate
    //console.log(plans[1][4]); //rate_area

    //prints entire list for ZIPs
    //console.log(zips[1]);

    //console.log(zips[1][0]); //zip_code
    //console.log(zips[1][1]); //state
    //console.log(zips[1][2]); //county_code
    //console.log(zips[1][3]); //name
    //console.log(zips[1][4]); //rate_area

    //console.log(plans);

});
</script>
</head>
<body>

<div id="plans_data">
  </div>

</body>
</html>
